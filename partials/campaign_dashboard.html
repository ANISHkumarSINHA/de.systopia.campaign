<!--
/*#######################################################+
| de.systopia.campaign                                   |
| Copyright (C) 2015 SYSTOPIA                            |
| Author: N. Bochan (bochan -at- systopia.de)            |
| http://www.systopia.de/                                |
+########################################################+
| This program is released as free software under the    |
| Affero GPL license. You can redistribute it and/or     |
| modify it under the terms of this license which you    |
| can read by viewing the included agpl.txt or online    |
| at www.gnu.org/licenses/agpl.html. Removal of this     |
| copyright header is strictly prohibited without        |
| written permission from the original author(s).        |
+########################################################*/
-->

<div id="campaign_container">
   <div id="campaign_summary">
      <h1>{{currentCampaign.title}} {{currentCampaign.is_active === "1" ? "" : "(INACTIVE)"}}</h1>
      <div id="breadcrumb">
         <div class="parents" ng-show="numberof.parents > 0">
            Parent Campaign(s) [{{numberof.parents}}]
           <!-- parents -->
           <a ng-repeat-start="(key, value) in parents | orderBy:'$index':true" href="#/campaign/{{value.id}}/view" ng-if="numberof.parents > 0">{{value.title}}</a> <span ng-repeat-end>&gt; </span>
           <!-- current -->
           <a href="#/campaign/{{currentCampaign.id}}/view" class="current">{{currentCampaign.title}}</a>
         </div>
         <div class="children" ng-if="numberof.children > 0">
            Child Campaign(s) [{{numberof.children}}]
           <!-- children -->
           <a ng-repeat-start="(key, value) in children" href="#/campaign/{{key}}/view">{{value}}</a> <span ng-repeat-end ng-if="!$last">| </span>
         </div>
      </div>
      <div id="actions">
        <a href="{{tree_link}}" class="button">View Campaign Tree</a>
        <a href="{{edit_link}}" class="button">Edit Campaign</a>
        <a href="{{subcampaign_link}}" class="button">Create Subcampaign</a>
        <a href="{{clone_link}}" class="button">Clone Campaign</a>
      </div>
      <div id="info">
         <table class="cmpinfo">

            <tr>
              <td>Is Active</td>
              <td>{{currentCampaign.status_id_text ? currentCampaign.status_id_text : '-' }}</td>
              <td><a crm-confirm="{message: ts('Are you sure you want to apply this status id to all children?')}" on-yes="applyToChildren('status_id', currentCampaign.status_id)" class="button">Apply to Children</a></td>
            </tr>
           <tr>
             <td>Is Active</td>
             <td>{{currentCampaign.is_active ? ts('True') : ts('False') }}</td>
             <td><a crm-confirm="{message: ts('Are you sure you want to apply this status to all children?')}" on-yes="applyToChildren('is_active', currentCampaign.is_active)" class="button">Apply to Children</a></td>
           </tr>
           <tr>
             <td>External Identifier</td>
             <td>{{currentCampaign.external_identifier ? currentCampaign.external_identifier : "-"}}</td>
           </tr>
           <tr>
             <td>Start date</td>
             <td>{{currentCampaign.start_date ? currentCampaign.start_date_date : "-"}}</td>
             <td><a crm-confirm="{message: ts('Are you sure you want to apply this start date to all children?')}" on-yes="applyToChildren('start_date', currentCampaign.start_date)" class="button">Apply to Children</a></td>
           </tr>
           <tr>
             <td>End date</td>
             <td>{{currentCampaign.end_date ? currentCampaign.end_date_date : "-"}}</td>
             <td><a crm-confirm="{message: ts('Are you sure you want to apply this end date to all children?')}" on-yes="applyToChildren('end_date', currentCampaign.end_date)" class="button">Apply to Children</a></td>
           </tr>
         </table>
      </div>
   </div>

   <div crm-ui-accordion="{title: ts('Campaign Information'), collapsed: true}" >
      <div class="label">Description</div>
      <div class="content">
         <div id="campaign_description">{{currentCampaign.description ? currentCampaign.description : "-"}}</div>
      </div>
      <div class="clear"></div>

      <div class="label" ng-if="currentCampaign.goal_general_htmlSafe">Goal</div>
      <div class="goalContent" ng-bind-html="currentCampaign.goal_general_htmlSafe"></div>
      <div class="clear"></div>
   </div>

   <div crm-ui-accordion="{title: ts('Key Performance Indicators (includes subcampaigns)')}" >
      <table class="kpitable">
        <tr ng-repeat="(key, value) in kpi">
          <td>{{value.title}}</td>
          <td>{{(value.type == "money") ? (value.value | currency:"USD $") : (value.type == "percentage" ? (value.value == -1 ? "-" : (value.value * 100 | number:2) + "%") : (value.value | number))}}</td>
        </tr>
      </table>
   </div>

   <div crm-ui-accordion="{title: ts('Campaign Expenses (only this campaign)')}" >
      <a ng-click="addExpense()" class="button addExpense">Add Expense</a>
      <table class="expsumtable">
        <tr>
           <td>Costs (only this campaign)</td>
           <td>{{expense_sum | currency:"USD $"}}</td>
        </tr>
      </table>
      <table class="exptable">
         <tr>
            <th>
              <a href="" ng-click="order('amount')">Amount</a>
              <span class="sortorder" ng-show="predicate === 'amount'" ng-class="{reverse:reverse}"></span
            </th>
            <th>
              <a href="" ng-click="order('description')">Description</a>
              <span class="sortorder" ng-show="predicate === 'description'" ng-class="{reverse:reverse}"></span
            </th>
            <th>
              <a href="" ng-click="order('category')">Category</a>
              <span class="sortorder" ng-show="predicate === 'category'" ng-class="{reverse:reverse}"></span
            </th>
            <th>
              <a href="" ng-click="order('created_date')">Date</a>
              <span class="sortorder" ng-show="predicate === 'created_date'" ng-class="{reverse:reverse}"></span
            </th>
            <th>Actions</th>
         </tr>
         <tr ng-repeat="expense in expenses | orderBy:predicate:reverse">
            <td>{{expense.amount | currency:"USD $"}}</td>
            <td>{{expense.description ? (expense.description | limitTo : 50) : ('-')}}{{expense.description.length > 50 ? '...' : ''}}</td>
            <td>{{expense.expense_type}}</td>
            <td>{{expense.created_date}}</td>
            <td><a class="button" ng-click="editExpense(expense)">Edit</a> <a crm-confirm="{message: ts('Are you sure you want to delete this expense?')}" on-yes="deleteExpense(expense)" class="button">Delete</a></td>
         </tr>
         <tr ng-show="expenses.length < 1"><td colspan="5"><span class="centered">No expenses found</span></td></tr>
      </table>
   </div>

</div>
